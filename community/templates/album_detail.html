{% extends 'base.html' %}

{% block body %}
<div class="container mt-4">
    <h3 class="fw-bold mb-4">{{album_name}}</h3>

    <!--filepond ì—…ë¡œë“œ input-->
    <input type="file" class="filepond" name="filepond" multiple data-max-files="10">

    <!--ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ì¸ë„¤ì¼ ëª©ë¡-->
    <div id="gallery" class="d-flex flex-wrap gap-3 mt-4">
        {% for photo in photos %}
        <img src="{{photo.image.url}}"
            class="album-image rounded"
            data-photo-id="{{photo.id}}"
            style="width: 150px; height: 150px; object-fit: cover; cursor: pointer;">
        {% endfor %}
    </div>

    <!--ëŒ“ê¸€ì°½(ì‚¬ì§„ í´ë¦­ ì‹œ ì—´ë¦¼)-->
    <div id="commentBox" class="card mt-4" style="display: none; max-width: 500px;">
        <div class="card-body">
            <h5 class="card-title">ì˜¤ëŠ˜ ì–´ë• ì–´?</h5>

            <form id="commentForm">
                <!--ì•½ì†ì´ ì–´ë• ëŠ”ì§€-->
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="mood" value="ì¢‹ì•˜ì–´" id="mood1">
                    <label class="form-check-label" for="mood1">ğŸ˜Š ì¢‹ì•˜ì–´</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="mood" value="ê·¸ëƒ¥ ê·¸ë¬ì–´" id="mood2">
                    <label class="form-check-label" for="mood2">ğŸ˜ ê·¸ëƒ¥ ê·¸ë¬ì–´</label>
                </div>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="radio" name="mood" value="ë³„ë¡œì˜€ì–´" id="mood3">
                    <label class="form-check-label" for="mood3">ğŸ˜ ë³„ë¡œì˜€ì–´</label>
                </div>

                <textarea id="commentInput" class="form-control mb-2" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" rows="2"></textarea>
                <button type="submit" class="btn btn-outline-primary btn-sm">ëŒ“ê¸€</button>
            </form>

            <div id="commentList" class="mt-3"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!--FilePond ë¼ì´ë¸ŒëŸ¬ë¦¬-->
<link href="https://unpkg.com/filepond/dist/filepond.min.css" rel="stylesheet" />
<link href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.min.css" rel="stylesheet" />
<script src="https://unpkg.com/filepond/dist/filepond.min.js"></script>
<script src="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // FilePond ë“±ë¡ ë° ì„œë²„ ì—°ê²°
        FilePond.registerPlugin(FilePondPluginImagePreview);
        FilePond.create(document.querySelector('.filepond'), {
            server: {
                process: '/upload/',
                revert: '/revert',
                headers: {
                    'X-CSRFToken': '{{csrf_token}}'
                }
            }
        });

        const gallery = document.getElementById('gallery');
        const commentBox = document.getElementById('commentBox');
        const commentInput = document.getElementById('commentInput');
        const commentList = document.getElementById('commentList');
        const commentForm = document.getElementById('commentForm');

        let selectedPhotoId = null;

        // ì´ë¯¸ì§€ í´ë¦­ ì‹œ ëŒ“ê¸€ì°½ í‘œì‹œ
        gallery.addEventListener("click", function (e) {
            if (e.target.classList.contains("album-image")) {
                selectedPhotoId = e.target.dataset.photoId;
                commentBox.style.display = "block";
                commentInput.value = '';
                commentList.innerHTML = '';
            }    
        });

        // ëŒ“ê¸€ ì €ì¥
        commentForm.addEventListener("submit", function (e) {
            e.preventDefault();
            const text = commentInput.value.trim();
            const mood = commentForm.querySelector("input[name='mood']:checked")?.value;

            if (text && mood && selectedPhotoId) {
                const item = document.createElement("div");
                item.innerHTML = `<strong>${mood}</strong> - ${text}`;
                commentList.appendChild(item);
                commentInput.value = '';
                commentForm.querySelector("input[name='mood']:checked").checked = false;
                }
            });
        });
</script>
{% endblock %}