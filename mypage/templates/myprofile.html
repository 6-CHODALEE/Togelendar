{% extends 'base.html' %}

{% block body %}
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <h3 class="mb-4">ê¸°ë³¸ í”„ë¡œí•„ ìˆ˜ì •</h3>

    <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ -->
    <div class="mb-3">
        <img src="{{ me.profile_image.url }}" class="rounded-circle mb-2"
             style="width: 170px; height: 170px; object-fit: cover;" alt="í”„ë¡œí•„ ì´ë¯¸ì§€">
        <div>
            <label for="id_profile_image" class="btn btn-outline-secondary mt-2">í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½í•˜ê¸°</label>
            <input type="file" name="profile_image" id="id_profile_image" style="display:none;">
        </div>
    </div>

    <!-- ì‚¬ìš©ì ì´ë¦„ -->
    <div class="mb-3">
        <label for="{{ form.username.id_for_label }}">ì‚¬ìš©ì ì´ë¦„</label>
        {{ form.username }}
    </div>

    <!-- ì´ë©”ì¼ -->
    <div class="mb-3">
        <label for="{{ form.email.id_for_label }}">ì´ë©”ì¼</label>
        {{ form.email }}
    </div>

    <!-- ìš°í¸ë²ˆí˜¸/ì£¼ì†Œ: ì‚¬ìš©ììš© ë³´ì´ëŠ” í•„ë“œ + Django í•„ë“œ -->
    <div class="mb-3 row">
        <div class="col">
            <label for="visible_postcode" class="form-label">ìš°í¸ë²ˆí˜¸</label>
            <input type="text" id="visible_postcode" class="form-control" readonly>
        </div>
        <div class="col-auto align-self-end">
            <button type="button" onclick="execDaumPostcode()" class="btn btn-outline-secondary">
                ìš°í¸ë²ˆí˜¸ ì°¾ê¸°
            </button>
        </div>
    </div>

    <div class="mb-3">
        <label for="visible_address" class="form-label">ì£¼ì†Œ</label>
        <input type="text" id="visible_address" class="form-control" readonly>
    </div>

    <!-- ì‹¤ì œ Django form í•„ë“œ (ìˆ¨ê¹€ ì²˜ë¦¬ X, ê°’ë§Œ ìë™ ì…ë ¥ë¨) -->
    {{ form.postcode }}
    {{ form.address }}

    <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ -->
    <div class="mb-3">
        <label for="{{ form.password1.id_for_label }}">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
        {{ form.password1 }}
    </div>
    <div class="mb-3">
        <label for="{{ form.password2.id_for_label }}">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
        {{ form.password2 }}
    </div>

    <button type="submit" class="btn btn-primary">ìˆ˜ì • ì™„ë£Œ</button>
</form>

<!-- ğŸ“Œ Daum ì£¼ì†Œ API ìŠ¤í¬ë¦½íŠ¸ -->
<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
function execDaumPostcode() {
    new daum.Postcode({
        oncomplete: function(data) {
            const zonecode = data.zonecode;
            const address = data.roadAddress ? data.roadAddress : data.jibunAddress;

            // ì‚¬ìš©ìì—ê²Œ ë³´ì´ëŠ” input
            document.getElementById('visible_postcode').value = zonecode;
            document.getElementById('visible_address').value = address;

            // Django í¼ í•„ë“œ
            document.getElementById('id_postcode').value = zonecode;
            document.getElementById('id_address').value = address;
        }
    }).open();
}
</script>
{% endblock %}