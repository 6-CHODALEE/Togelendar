{% extends 'base.html' %}

{% block body %}
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <h3 class="mb-4">기본 프로필 수정</h3>

    <!-- 프로필 이미지 -->
    <div class="mb-3">
        <img src="{{ me.profile_image.url }}" class="rounded-circle mb-2"
             style="width: 170px; height: 170px; object-fit: cover;" alt="프로필 이미지">
        <div>
            <label for="id_profile_image" class="btn btn-outline-secondary mt-2">프로필 이미지 변경하기</label>
            <input type="file" name="profile_image" id="id_profile_image" style="display:none;">
        </div>
    </div>

    <!-- 사용자 이름 -->
    <div class="mb-3">
        <label for="{{ form.username.id_for_label }}">사용자 이름</label>
        {{ form.username }}
    </div>

    <!-- 이메일 -->
    <div class="mb-3">
        <label for="{{ form.email.id_for_label }}">이메일</label>
        {{ form.email }}
    </div>

    <!-- 우편번호/주소: 사용자용 보이는 필드 + Django 필드 -->
    <div class="mb-3 row">
        <div class="col">
            <label for="visible_postcode" class="form-label">우편번호</label>
            <input type="text" id="visible_postcode" class="form-control" readonly>
        </div>
        <div class="col-auto align-self-end">
            <button type="button" onclick="execDaumPostcode()" class="btn btn-outline-secondary">
                우편번호 찾기
            </button>
        </div>
    </div>

    <div class="mb-3">
        <label for="visible_address" class="form-label">주소</label>
        <input type="text" id="visible_address" class="form-control" readonly>
    </div>

    <!-- 실제 Django form 필드 (숨김 처리 X, 값만 자동 입력됨) -->
    {{ form.postcode }}
    {{ form.address }}

    <!-- 비밀번호 변경 -->
    <div class="mb-3">
        <label for="{{ form.password1.id_for_label }}">새 비밀번호</label>
        {{ form.password1 }}
    </div>
    <div class="mb-3">
        <label for="{{ form.password2.id_for_label }}">비밀번호 확인</label>
        {{ form.password2 }}
    </div>

    <button type="submit" class="btn btn-primary">수정 완료</button>
</form>

<!-- 📌 Daum 주소 API 스크립트 -->
<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
function execDaumPostcode() {
    new daum.Postcode({
        oncomplete: function(data) {
            const zonecode = data.zonecode;
            const address = data.roadAddress ? data.roadAddress : data.jibunAddress;

            // 사용자에게 보이는 input
            document.getElementById('visible_postcode').value = zonecode;
            document.getElementById('visible_address').value = address;

            // Django 폼 필드
            document.getElementById('id_postcode').value = zonecode;
            document.getElementById('id_address').value = address;
        }
    }).open();
}
</script>
{% endblock %}