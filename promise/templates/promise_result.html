{% extends 'base.html' %}

{% block body %}
<div class="container my-5">
    <div class="text-center">
        <h2>{{promise.promise_name}}의 약속 날짜가 정해졌어요!</h2>
        <!--필요없으면 지워도됨-->
        <ul style="display: inline-block; text-align: left;">
            {% for date in selected_dates %}
                <li>{{date}}</li>
            {% endfor %}
        </ul>
    </div>
    <div id="calendar" style="max-width: 800px; margin: 0 auto;"></div>
    <div style="max-width: 800px; margin: 10px auto 0 auto; display: flex; justify-content: flex-end; padding-right: 20px;">
        <a href="{% url 'community:community_detail' community.id %}" class="btn btn-outline-secondary btn-sm">
            커뮤니티로 이동하기
        </a>
    </div>
</div>

<style>
    .fc-day-today {
        background-color: transparent !important;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const calendarEl = document.getElementById('calendar');

        // 전체 투표 데이터 받아오기
        const allVotes = JSON.parse('{{all_vote_data|safe}}');

        // FullCalendar 초기화
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'ko',
            initialDate: allVotes.length > 0 ? allVotes[0].date : undefined,
            events: allVotes.map(item => {
                const intensity = Math.min(item.intensity, 1);
                // 점점 진하게 색 조절
                const color = `rgba(251, 211, 141, ${intensity})`
                return {
                    start: item.date,
                    end: item.date,
                    allDay: true,
                    display: 'background',
                    color: color
                };
            })
        });

        calendar.render();
    });
</script>
{% endblock %}